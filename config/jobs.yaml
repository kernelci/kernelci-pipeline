# SPDX-License-Identifier: LGPL-2.1-or-later
#
# Copyright (C) 2021, 2022, 2023 Collabora Limited
# Author: Guillaume Tucker <guillaume.tucker@collabora.com>

# Not directly loaded into the config, only used for YAML aliases in this file
_anchors:

### Job definition templates

  baseline-job: &baseline-job
    template: baseline.jinja2
    kind: job
    kcidb_test_suite: boot

  kbuild-job: &kbuild-job
    template: kbuild.jinja2
    kind: kbuild
    rules:
      tree:
      - '!android'
      - '!chromiumos'

  kbuild-clang-17-arm64-job: &kbuild-clang-17-arm64-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}clang-17:arm64-kselftest-kernelci
    params: &kbuild-clang-17-arm64-params
      arch: arm64
      compiler: clang-17
      cross_compile: 'aarch64-linux-gnu-'
      defconfig: defconfig

  kbuild-clang-17-x86-job: &kbuild-clang-17-x86-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}clang-17:x86-kselftest-kernelci
    params: &kbuild-clang-17-x86-params
      arch: x86_64
      compiler: clang-17
      defconfig: x86_64_defconfig

  kbuild-gcc-12-arm64-job: &kbuild-gcc-12-arm64-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:arm64-kselftest-kernelci
    params: &kbuild-gcc-12-arm64-params
      arch: arm64
      compiler: gcc-12
      cross_compile: 'aarch64-linux-gnu-'
      defconfig: defconfig
      fragments:
        - 'lab-setup'
        - 'kselftest'

  kbuild-gcc-12-x86-job: &kbuild-gcc-12-x86-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:x86-kselftest-kernelci
    params: &kbuild-gcc-12-x86-params
      arch: x86_64
      compiler: gcc-12
      defconfig: x86_64_defconfig
      fragments:
        - 'kselftest'

  ltp-job: &ltp-job
    template: ltp.jinja2
    kind: job
    params: &ltp-params
      boot_commands: nfs
      nfsroot: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-ltp/20240313.0/{debarch}'
      skip_install: "true"
      skipfile: skipfile-lkft.yaml
    kcidb_test_suite: ltp
    rules:
      fragments:
        - '!kselftest'

### Frequently used rules

  # A list of trees for which to run the build-only jobs.
  build-only-trees-rules: &build-only-trees-rules
    # NOTE: Please keep the trees list in sorted order.
    tree:
    - 'amlogic'
    - 'ardb'
    - 'arnd'
    - 'cip'
    - 'clk'
    - 'efi'
    - 'khilman'
    - 'krzysztof'
    - 'lee-backlight'
    - 'linusw'
    - 'linux-pci'
    - 'net-next'
    - 'next'
    - 'pm'
    - 'qcom'
    - 'renesas'
    - 'robh'
    - 'rppt'
    - 'sashal-next'
    - 'soc'
    - 'stable'
    - 'tegra'
    - 'thermal'
    - 'tip'
    - 'ulfh'
    - 'vireshk'


jobs:

  # FIXME This will need to be reworked later when the fstests scheduler has
  # been removed
  #
  # fstests:
  #   template: 'fstests.jinja2'
  #   image: 'kernelci/staging-kernelci'

  baseline-arm: *baseline-job
  baseline-arm-broonie: *baseline-job
  baseline-arm-baylibre: *baseline-job
  baseline-arm-clabbe: *baseline-job
  baseline-arm-kontron: *baseline-job
  baseline-arm-mfd: *baseline-job
  baseline-arm-pengutronix: *baseline-job
  baseline-arm64: *baseline-job
  baseline-arm64-android: *baseline-job
  baseline-arm64-broonie: *baseline-job
  baseline-arm64-clabbe: *baseline-job
  baseline-arm64-kcidebug-mediatek: *baseline-job
  baseline-arm64-kcidebug-qualcomm: *baseline-job
  baseline-arm64-kontron: *baseline-job
  baseline-arm64-mfd: *baseline-job
  baseline-arm64-pengutronix: *baseline-job
  baseline-arm64-qualcomm: *baseline-job
  baseline-riscv-clabbe: *baseline-job
  baseline-x86: *baseline-job
  baseline-x86-baylibre: *baseline-job
  baseline-x86-cip: *baseline-job
  baseline-x86-kcidebug-amd: *baseline-job
  baseline-x86-kcidebug-intel: *baseline-job
  baseline-x86-mfd: *baseline-job
  baseline-x86-qualcomm: *baseline-job

  kbuild-clang-17-arm: &kbuild-clang-17-arm-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}clang-17:arm-kselftest-kernelci
    params: &kbuild-clang-17-arm-params
      arch: arm
      compiler: clang-17
      cross_compile: 'arm-linux-gnueabihf-'
      defconfig: multi_v7_defconfig

  kbuild-clang-17-arm-allmodconfig:
    <<: *kbuild-clang-17-arm-job
    params:
      <<: *kbuild-clang-17-arm-params
      defconfig:
        - defconfig
        - allmodconfig
      fragments:
        - 'CONFIG_FRAME_WARN=2048'
    rules:
      tree:
        - 'mainline'
        - 'stable-rc'
        - 'stable'

  kbuild-clang-17-arm-android: &kbuild-clang-17-arm-android-job
    <<: *kbuild-clang-17-arm-job
    params: &kbuild-clang-17-arm-android-params
      <<: *kbuild-clang-17-arm-params
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-clang-17-arm-android-allmodconfig:
    <<: *kbuild-clang-17-arm-android-job
    params:
      <<: *kbuild-clang-17-arm-android-params
      defconfig:
        - imx_v6_v7_defconfig
        - 'allmodconfig'

  kbuild-clang-17-arm-android-imx_v6_v7_defconfig:
    <<: *kbuild-clang-17-arm-android-job
    params:
      <<: *kbuild-clang-17-arm-android-params
      defconfig: imx_v6_v7_defconfig

  kbuild-clang-17-arm-android-multi_v5_defconfig:
    <<: *kbuild-clang-17-arm-android-job
    params:
      <<: *kbuild-clang-17-arm-android-params
      defconfig: multi_v5_defconfig

  kbuild-clang-17-arm-android-omap2plus_defconfig:
    <<: *kbuild-clang-17-arm-android-job
    params:
      <<: *kbuild-clang-17-arm-android-params
      defconfig: omap2plus_defconfig
    rules:
      tree:
      - 'omap'

  kbuild-clang-17-arm-android-vexpress_defconfig:
    <<: *kbuild-clang-17-arm-android-job
    params:
      <<: *kbuild-clang-17-arm-android-params
      defconfig: vexpress_defconfig

  kbuild-clang-17-arm64-allmodconfig:
    <<: *kbuild-clang-17-arm64-job
    params:
      <<: *kbuild-clang-17-arm64-params
      defconfig:
        - defconfig
        - allmodconfig
    rules:
      tree:
        - 'mainline'
        - 'stable-rc'
        - 'stable'

  kbuild-clang-17-arm64-allnoconfig:
    <<: *kbuild-clang-17-arm64-job
    params:
      <<: *kbuild-clang-17-arm64-params
      defconfig:
        - defconfig
        - allnoconfig
    rules:
      tree:
        - 'mainline'

  kbuild-clang-17-arm64-android: &kbuild-clang-17-arm64-android-job
    <<: *kbuild-clang-17-arm64-job
    params: &kbuild-clang-17-arm64-android-params
      <<: *kbuild-clang-17-arm64-params
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-clang-17-arm64-android-allmodconfig:
    <<: *kbuild-clang-17-arm64-android-job
    params:
      <<: *kbuild-clang-17-arm64-android-params
      defconfig:
        - defconfig
        - allmodconfig

  kbuild-clang-17-arm64-android-allnoconfig:
    <<: *kbuild-clang-17-arm64-android-job
    params:
      <<: *kbuild-clang-17-arm64-android-params
      defconfig:
        - defconfig
        - allnoconfig

  kbuild-clang-17-arm64-android-big_endian:
    <<: *kbuild-clang-17-arm64-android-job
    params:
      <<: *kbuild-clang-17-arm64-android-params
      fragments:
       - CONFIG_CPU_BIG_ENDIAN=y

  kbuild-clang-17-arm64-android-randomize:
    <<: *kbuild-clang-17-arm64-android-job
    params:
      <<: *kbuild-clang-17-arm64-android-params
      fragments:
       - CONFIG_RANDOMIZE_BASE=y

  kbuild-clang-17-arm64-kselftest:
    <<: *kbuild-clang-17-arm64-job
    params:
      <<: *kbuild-clang-17-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'kselftest'
    rules: &kbuild-kselftest-rules
      tree:
        - 'kselftest'
        - 'mainline'
        - 'next'
        - 'stable'
        - 'stable-rc'
      fragments:
        - kselftest

  kbuild-clang-17-arm64-mainline: &kbuild-clang-17-arm64-mainline-job
    <<: *kbuild-clang-17-arm64-job
    rules:
      tree:
        - 'mainline'
        - 'next'
        - 'sashal-next'

  kbuild-clang-17-arm64-mainline-64K_PAGES:
    <<: *kbuild-clang-17-arm64-mainline-job
    params:
      <<: *kbuild-clang-17-arm64-params
      fragments:
        - 'CONFIG_ARM64_64K_PAGES=y'

  kbuild-clang-17-arm-mainline: &kbuild-clang-17-arm-mainline-job
    <<: *kbuild-clang-17-arm-job
    params:
      <<: *kbuild-clang-17-arm-params
    rules:
      tree:
        - 'mainline'
        - 'next'
        - 'sashal-next'

  kbuild-clang-17-arm-mainline-allnoconfig:
    <<: *kbuild-clang-17-arm-mainline-job
    params:
      <<: *kbuild-clang-17-arm-params
      defconfig:
        - multi_v7_defconfig
        - allnoconfig

  kbuild-clang-17-arm-mainline-aspeed_g5:
    <<: *kbuild-clang-17-arm-mainline-job
    params:
      <<: *kbuild-clang-17-arm-params
      defconfig:
        - aspeed_g5_defconfig

  kbuild-clang-17-arm-mainline-multi_v5:
    <<: *kbuild-clang-17-arm-mainline-job
    params:
      <<: *kbuild-clang-17-arm-params
      defconfig:
        - multi_v5_defconfig

  kbuild-clang-17-i386: &kbuild-clang-17-i386-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}clang-17:x86-kselftest-kernelci
    params: &kbuild-clang-17-i386-params
      arch: i386
      compiler: clang-17
      defconfig: i386_defconfig

  kbuild-clang-17-i386-allnoconfig:
    <<: *kbuild-clang-17-i386-job
    params:
      <<: *kbuild-clang-17-i386-params
      defconfig:
        - i386_defconfig
        - allnoconfig
    rules:
      tree:
      - 'mainline'
      - 'next'
      - 'sashal-next'

  kbuild-clang-17-i386-android-allnoconfig:
    <<: *kbuild-clang-17-i386-job
    params:
      <<: *kbuild-clang-17-i386-params
      defconfig:
        - i386_defconfig
        - allnoconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-clang-17-riscv: &kbuild-clang-17-riscv-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}clang-17:riscv64-kselftest-kernelci
    params: &kbuild-clang-17-riscv-params
      arch: riscv
      compiler: clang-17
      cross_compile: 'riscv64-linux-gnu-'
      defconfig: defconfig

  kbuild-clang-17-riscv-defconfig:
    <<: *kbuild-clang-17-riscv-job
    params:
      <<: *kbuild-clang-17-riscv-params
      defconfig:
        - defconfig
        - allnoconfig
    rules:
      min_version:
        version: 4
        patchlevel: 19
      tree:
      - 'next'
      - 'sashal-next'

  kbuild-clang-17-riscv-android-defconfig:
    <<: *kbuild-clang-17-riscv-job
    params:
      <<: *kbuild-clang-17-riscv-params
      defconfig:
        - defconfig
        - allnoconfig
      kselftest: disable
    rules: &kbuild-riscv-android-rules
      min_version:
        version: 4
        patchlevel: 19
      tree:
      - 'android'

  kbuild-clang-17-riscv-smp:
    <<: *kbuild-clang-17-riscv-job
    params:
      <<: *kbuild-clang-17-riscv-params
      fragments:
        - 'CONFIG_SMP=n'
    rules:
      tree:
      - 'riscv'

  kbuild-clang-17-x86:
    <<: *kbuild-clang-17-x86-job

  kbuild-clang-17-x86-android-allmodconfig:
    <<: *kbuild-clang-17-x86-job
    params:
      <<: *kbuild-clang-17-x86-params
      defconfig:
        - x86_64_defconfig
        - allmodconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-clang-17-x86-allmodconfig:
    <<: *kbuild-clang-17-x86-job
    params:
      <<: *kbuild-clang-17-x86-params
      defconfig:
        - x86_64_defconfig
        - allmodconfig
    rules:
      tree:
      - 'mainline'
      - 'stable-rc'
      - 'stable'

  kbuild-clang-17-x86-allnoconfig:
    <<: *kbuild-clang-17-x86-job
    params:
      <<: *kbuild-clang-17-x86-params
      defconfig:
        - x86_64_defconfig
        - allnoconfig
    rules:
      tree:
      - 'mainline'
      - 'next'
      - 'sashal-next'

  kbuild-clang-17-x86-android-allnoconfig:
    <<: *kbuild-clang-17-x86-job
    params:
      <<: *kbuild-clang-17-x86-params
      defconfig:
        - x86_64_defconfig
        - allnoconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-clang-17-x86-kselftest:
    <<: *kbuild-clang-17-x86-job
    params:
      <<: *kbuild-clang-17-x86-params
      defconfig:
        - x86_64_defconfig
      fragments:
        - 'kselftest'
        - 'x86-board'
    rules:
      <<: *kbuild-kselftest-rules

  # Default config and build only job
  kbuild-gcc-12-arc-build-only: &kbuild-gcc-12-arc-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:arc-kselftest-kernelci
    params: &kbuild-gcc-12-arc-params
      arch: arc
      compiler: gcc-12
      cross_compile: 'arc-elf32-'
      defconfig: haps_hs_smp_defconfig
    rules: *build-only-trees-rules

  kbuild-gcc-12-arc-hs_smp_defconfig-allnoconfig:
    <<: *kbuild-gcc-12-arc-job
    params:
      <<: *kbuild-gcc-12-arc-params
      defconfig:
        - haps_hs_smp_defconfig
        - allnoconfig

  kbuild-gcc-12-arc-haps_hs_smp_defconfig:
    <<: *kbuild-gcc-12-arc-job
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'
      - 'next'
      - 'sashal-next'

  kbuild-gcc-12-arc-mainline: &kbuild-gcc-12-arc-mainline-job
    <<: *kbuild-gcc-12-arc-job
    params: &kbuild-gcc-12-arc-mainline-params
      <<: *kbuild-gcc-12-arc-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      min_version:
        version: 4
        patchlevel: 10
      tree:
        - 'mainline'

  kbuild-gcc-12-arc-mainline-allnoconfig:
    <<: *kbuild-gcc-12-arc-mainline-job
    params:
      <<: *kbuild-gcc-12-arc-mainline-params
      defconfig:
        - haps_hs_smp_defconfig
        - allnoconfig

  kbuild-gcc-12-arm: &kbuild-gcc-12-arm-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:arm-kselftest-kernelci
    params: &kbuild-gcc-12-arm-params
      arch: arm
      compiler: gcc-12
      cross_compile: 'arm-linux-gnueabihf-'
      defconfig: multi_v7_defconfig

  kbuild-gcc-12-arm-allnoconfig: &kbuild-gcc-12-arm-allnoconfig-job
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig:
        - multi_v7_defconfig
        - allnoconfig
    rules:
      tree:
        - 'next'
        - 'sashal-next'

  kbuild-gcc-12-arm-BIG_ENDIAN:
    <<: *kbuild-gcc-12-arm-allnoconfig-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_CPU_BIG_ENDIAN=y'

  kbuild-gcc-12-arm-cip-allnoconfig:
    <<: *kbuild-gcc-12-arm-allnoconfig-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig:
        - multi_v7_defconfig
        - allnoconfig
      fragments:
        - 'cip://6.1.y-cip/arm/qemu_arm_defconfig'
    rules:
      branch:
        - 'cip:linux-6.1.y-cip'
        - 'cip:linux-6.1.y-cip-rt'

  kbuild-gcc-12-arm-SMP:
    <<: *kbuild-gcc-12-arm-allnoconfig-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_SMP=n'

  kbuild-gcc-12-arm-EFI:
    <<: *kbuild-gcc-12-arm-allnoconfig-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_EFI=y'
        - 'CONFIG_ARM_LPAE=y'

  kbuild-gcc-12-arm-THUMB2:
    <<: *kbuild-gcc-12-arm-allnoconfig-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_THUMB2_KERNEL=y'

  kbuild-gcc-12-arm-android: &kbuild-gcc-12-arm-android-job
    <<: *kbuild-gcc-12-arm-job
    params: &kbuild-gcc-12-arm-android-params
      <<: *kbuild-gcc-12-arm-params
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-gcc-12-arm-android-allmodconfig:
    <<: *kbuild-gcc-12-arm-android-job
    params:
      <<: *kbuild-gcc-12-arm-android-params
      defconfig:
        - imx_v6_v7_defconfig
        - allmodconfig

  kbuild-gcc-12-arm-android-imx_v6_v7_defconfig:
    <<: *kbuild-gcc-12-arm-android-job
    params:
      <<: *kbuild-gcc-12-arm-android-params
      defconfig: imx_v6_v7_defconfig

  kbuild-gcc-12-arm-android-multi_v5_defconfig:
    <<: *kbuild-gcc-12-arm-android-job
    params:
      <<: *kbuild-gcc-12-arm-android-params
      defconfig: multi_v5_defconfig

  kbuild-gcc-12-arm-android-omap2plus_defconfig:
    <<: *kbuild-gcc-12-arm-android-job
    params:
      <<: *kbuild-gcc-12-arm-android-params
      defconfig: omap2plus_defconfig
    rules:
      tree:
      - 'omap'

  kbuild-gcc-12-arm-android-vexpress_defconfig:
    <<: *kbuild-gcc-12-arm-android-job
    params:
      <<: *kbuild-gcc-12-arm-android-params
      defconfig: vexpress_defconfig

  # Default config and build only job
  kbuild-gcc-12-arm-build-only:
    <<: *kbuild-gcc-12-arm-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-arm-imx_v6_v7_defconfig:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig: imx_v6_v7_defconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-arm-kselftest:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'kselftest'
    rules:
      <<: *kbuild-kselftest-rules

  kbuild-gcc-12-arm-mainline: &kbuild-gcc-12-arm-mainline-job
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      tree:
        - 'mainline'

  kbuild-gcc-12-arm-mainline-allnoconfig:
    <<: *kbuild-gcc-12-arm-mainline-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig:
        - multi_v7_defconfig
        - allnoconfig
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'

  kbuild-gcc-12-arm-mainline-BIG_ENDIAN:
    <<: *kbuild-gcc-12-arm-mainline-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_CPU_BIG_ENDIAN=y'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'

  kbuild-gcc-12-arm-mainline-EFI:
    <<: *kbuild-gcc-12-arm-mainline-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_EFI=y'
        - 'CONFIG_ARM_LPAE=y'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'

  kbuild-gcc-12-arm-mainline-SMP:
    <<: *kbuild-gcc-12-arm-mainline-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_SMP=n'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'

  kbuild-gcc-12-arm-mainline-THUMB2:
    <<: *kbuild-gcc-12-arm-mainline-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
        - 'CONFIG_THUMB2_KERNEL=y'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'

  kbuild-gcc-12-arm-mfd:
    <<: *kbuild-gcc-12-arm-job
    rules:
      tree:
      - 'lee-mfd'

  kbuild-gcc-12-arm-multi_v5_defconfig:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig: multi_v5_defconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-arm-multi_v7_defconfig:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig: multi_v7_defconfig
    rules:
      tree:
      - 'chrome-platform'
      - 'kernelci'
      - 'omap'
      - 'stable'
      - 'stable-rc'

  kbuild-gcc-12-arm-omap2plus_defconfig:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig: omap2plus_defconfig
    rules:
      tree:
      - 'omap'

  kbuild-gcc-12-arm-preempt_rt:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      fragments:
       - 'preempt_rt'
      defconfig: multi_v7_defconfig
    rules:
      tree:
      - 'stable-rt'
      - 'mainline'
      - 'next'

  kbuild-gcc-12-arm-vexpress_defconfig:
    <<: *kbuild-gcc-12-arm-job
    params:
      <<: *kbuild-gcc-12-arm-params
      defconfig: vexpress_defconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-arm64: *kbuild-gcc-12-arm64-job

  kbuild-gcc-12-arm64-chromebook-main:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'lab-setup'
        - 'kselftest'
        - 'arm64-chromebook'
    rules:
      tree:
      - '!omap'

  kbuild-gcc-12-arm64-allnoconfig:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      defconfig:
        - defconfig
        - allnoconfig
    rules:
      tree:
      - 'arm64'
      - 'next'
      - 'sashal-next'

  kbuild-gcc-12-arm64-android: &kbuild-gcc-12-arm64-android-job
    <<: *kbuild-gcc-12-arm64-job
    params: &kbuild-gcc-12-arm64-android-params
      <<: *kbuild-gcc-12-arm64-params
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-gcc-12-arm64-android-allmodconfig:
    <<: *kbuild-gcc-12-arm64-android-job
    params:
      <<: *kbuild-gcc-12-arm64-android-params
      defconfig:
        - defconfig
        - allmodconfig

  kbuild-gcc-12-arm64-android-allnoconfig:
    <<: *kbuild-gcc-12-arm64-android-job
    params:
      <<: *kbuild-gcc-12-arm64-android-params
      defconfig:
        - defconfig
        - allnoconfig

  kbuild-gcc-12-arm64-android-big_endian:
    <<: *kbuild-gcc-12-arm64-android-job
    params:
      <<: *kbuild-gcc-12-arm64-android-params
      fragments:
       - CONFIG_CPU_BIG_ENDIAN=y

  kbuild-gcc-12-arm64-android-randomize:
    <<: *kbuild-gcc-12-arm64-android-job
    params:
      <<: *kbuild-gcc-12-arm64-android-params
      fragments:
       - CONFIG_RANDOMIZE_BASE=y

  kbuild-gcc-12-arm64-16k_pages: &kbuild-gcc-12-arm64-16k_pages-job
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'CONFIG_ARM64_16K_PAGES=y'
    rules:
      tree:
      - 'next'
      - 'sashal-next'

  kbuild-gcc-12-arm64-64k_pages:
    <<: *kbuild-gcc-12-arm64-16k_pages-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'CONFIG_ARM64_64K_PAGES=y'

  kbuild-gcc-12-arm64-big_endian:
    <<: *kbuild-gcc-12-arm64-16k_pages-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'CONFIG_CPU_BIG_ENDIAN=y'

  kbuild-gcc-12-arm64-randomize:
    <<: *kbuild-gcc-12-arm64-16k_pages-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'CONFIG_RANDOMIZE_BASE=y'

  kbuild-gcc-12-arm64-kselftest-16k_pages:
    <<: *kbuild-gcc-12-arm64-16k_pages-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'kselftest'
    rules:
      tree:
      - '!omap'

  # Default config and build only job
  kbuild-gcc-12-arm64-build-only:
    <<: *kbuild-gcc-12-arm64-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-arm64-chrome-platform:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
       - 'arm64-chromebook'
    rules:
      tree:
      - 'chrome-platform'
      - 'mediatek'

  kbuild-gcc-12-arm64-chromebook-kcidebug:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      cross_compile_compat: 'arm-linux-gnueabihf-'
      fragments:
        - arm64-chromebook
        - kcidebug
        - lab-setup
    rules:
      tree:
      - '!omap'

  kbuild-gcc-12-arm64-dtbscheck:
    <<: *kbuild-gcc-12-arm64-job
    kind: job
    params:
      <<: *kbuild-gcc-12-arm64-params
      dtbs_check: true
    kcidb_test_suite: dtbs_check

  kbuild-gcc-12-arm64-kselftest:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'kselftest'
    rules:
      <<: *kbuild-kselftest-rules
      tree:
      - '!omap'

  kbuild-gcc-12-arm64-mainline: &kbuild-gcc-12-arm64-mainline-job
    <<: *kbuild-gcc-12-arm64-job
    params: &kbuild-gcc-12-arm64-mainline-params
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      tree:
        - 'mainline'

  kbuild-gcc-12-arm64-mainline-allnoconfig:
    <<: *kbuild-gcc-12-arm64-mainline-job
    params:
      <<: *kbuild-gcc-12-arm64-mainline-params
      defconfig:
        - defconfig
        - allnoconfig

  kbuild-gcc-12-arm64-mainline-big_endian:
    <<: *kbuild-gcc-12-arm64-mainline-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
        - 'arm64-chromebook'
        - 'CONFIG_CPU_BIG_ENDIAN=y'
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      tree:
      - '!omap'

  kbuild-gcc-12-arm64-mfd:
    <<: *kbuild-gcc-12-arm64-job
    rules:
      tree:
      - 'lee-mfd'

  kbuild-gcc-12-arm64-preempt_rt:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
       - 'preempt_rt'
      defconfig: defconfig
    rules:
      tree:
      - 'stable-rt'
      - 'mainline'
      - 'next'

  kbuild-gcc-12-arm64-preempt_rt_chromebook:
    <<: *kbuild-gcc-12-arm64-job
    params:
      <<: *kbuild-gcc-12-arm64-params
      fragments:
       - 'arm64-chromebook'
       - 'preempt_rt'
      defconfig: defconfig
    rules:
      tree:
      - 'stable-rt'
      - 'mainline'
      - 'next'

  kbuild-gcc-12-i386: &kbuild-gcc-12-i386-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:x86-kselftest-kernelci
    params: &kbuild-gcc-12-i386-params
      arch: i386
      compiler: gcc-12
      defconfig: i386_defconfig

  kbuild-clang-17-i386-allmodconfig:
    <<: *kbuild-clang-17-i386-job
    params:
      <<: *kbuild-clang-17-i386-params
      defconfig:
        - i386_defconfig
        - allmodconfig
      fragments:
        - 'CONFIG_FRAME_WARN=2048'
    rules:
      tree:
      - 'mainline'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-i386-allnoconfig:
    <<: *kbuild-gcc-12-i386-job
    params:
      <<: *kbuild-gcc-12-i386-params
      defconfig: allnoconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'
      - 'next'
      - 'sashal-next'

  kbuild-gcc-12-i386-android-allnoconfig:
    <<: *kbuild-gcc-12-i386-job
    params:
      <<: *kbuild-gcc-12-i386-params
      defconfig:
        - i386_defconfig
        - allnoconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  # Default config and build only job
  kbuild-gcc-12-i386-build-only:
    <<: *kbuild-gcc-12-i386-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-i386-kselftest:
    <<: *kbuild-gcc-12-i386-job
    params:
      <<: *kbuild-gcc-12-i386-params
      fragments:
        - 'kselftest'
    rules:
      <<: *kbuild-kselftest-rules

  kbuild-gcc-12-i386-mainline: &kbuild-gcc-12-i386-mainline-job
    <<: *kbuild-gcc-12-i386-job
    params: &kbuild-gcc-12-i386-mainline-params
      <<: *kbuild-gcc-12-i386-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      tree:
        - 'mainline'

  kbuild-gcc-12-i386-mainline-allnoconfig:
    <<: *kbuild-gcc-12-i386-mainline-job
    params:
      <<: *kbuild-gcc-12-i386-mainline-params
      defconfig:
        - defconfig
        - allnoconfig

  kbuild-gcc-12-i386-mfd:
    <<: *kbuild-gcc-12-i386-job
    rules:
      tree:
      - 'lee-mfd'

  kbuild-gcc-12-i386-tinyconfig:
    <<: *kbuild-gcc-12-i386-job
    params:
      <<: *kbuild-gcc-12-i386-params
      defconfig: tinyconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-mips-32r2el_defconfig: &kbuild-gcc-12-mips-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:mips-kselftest-kernelci
    params: &kbuild-gcc-12-mips-params
      arch: mips
      compiler: gcc-12
      cross_compile: 'mips-linux-gnu-'
      defconfig: 32r2el_defconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'
      - 'next'
      - 'sashal-next'

  kbuild-gcc-12-mips-allnoconfig:
    <<: *kbuild-gcc-12-mips-job
    params:
      <<: *kbuild-gcc-12-mips-params
      defconfig:
        - 32r2el_defconfig
        - allnoconfig
    rules:
      tree:
        - 'next'
        - 'sashal-next'

  # Default config and build only job
  kbuild-gcc-12-mips-build-only:
    <<: *kbuild-gcc-12-mips-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-mips-mainline: &kbuild-gcc-12-mips-mainline-job
    <<: *kbuild-gcc-12-mips-job
    params: &kbuild-gcc-12-mips-mainline-params
      <<: *kbuild-gcc-12-mips-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      tree:
        - 'mainline'

  kbuild-gcc-12-mips-mainline-allnoconfig:
    <<: *kbuild-gcc-12-mips-mainline-job
    params:
      <<: *kbuild-gcc-12-mips-mainline-params
      defconfig:
        - 32r2el_defconfig
        - allnoconfig

  kbuild-gcc-12-riscv: &kbuild-gcc-12-riscv-job
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:riscv64-kselftest-kernelci
    params: &kbuild-gcc-12-riscv-params
      arch: riscv
      compiler: gcc-12
      cross_compile: 'riscv64-linux-gnu-'
      defconfig: defconfig

  kbuild-gcc-12-riscv-android-defconfig:
    <<: *kbuild-gcc-12-riscv-job
    params:
      <<: *kbuild-gcc-12-riscv-params
      defconfig:
        - defconfig
        - allnoconfig
    rules:
      <<: *kbuild-riscv-android-rules

  # Default config and build only job
  kbuild-gcc-12-riscv-build-only:
    <<: *kbuild-gcc-12-riscv-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-riscv-mainline: &kbuild-gcc-12-riscv-mainline-job
    <<: *kbuild-gcc-12-riscv-job
    params: &kbuild-gcc-12-riscv-mainline-params
      <<: *kbuild-gcc-12-riscv-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
    rules:
      min_version:
        version: 4
        patchlevel: 15
      tree:
        - 'mainline'

  kbuild-gcc-12-riscv-mainline-allnoconfig:
    <<: *kbuild-gcc-12-riscv-mainline-job
    params:
      <<: *kbuild-gcc-12-riscv-mainline-params
      defconfig:
      - defconfig
      - allnoconfig

  kbuild-gcc-12-riscv-mfd:
    <<: *kbuild-gcc-12-riscv-job
    rules:
      tree:
      - 'lee-mfd'

  kbuild-gcc-12-riscv-nommu_k210_defconfig:
    <<: *kbuild-gcc-12-riscv-job
    params:
      <<: *kbuild-gcc-12-riscv-params
      defconfig: nommu_k210_defconfig
    rules:
      min_version:
        version: 5
        patchlevel: 10
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-riscv-smp:
    <<: *kbuild-gcc-12-riscv-job
    params:
      <<: *kbuild-gcc-12-riscv-params
      fragments:
        - 'CONFIG_SMP=n'
    rules:
      tree:
      - 'riscv'

  kbuild-gcc-12-um:
    <<: *kbuild-job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:x86-kselftest-kernelci
    params:
      arch: um
      compiler: gcc-12
      defconfig: defconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-gcc-12-x86:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      fragments:
        - 'lab-setup'
        - 'x86-board'
        - 'kselftest'
    rules:
      tree:
      - '!omap'

  kbuild-gcc-12-x86-allnoconfig:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      defconfig: allnoconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  kbuild-gcc-12-x86-android-allmodconfig: &kbuild-gcc-12-x86-android-allmodconfig-job
    <<: *kbuild-gcc-12-x86-job
    params: &kbuild-gcc-12-x86-android-params
      <<: *kbuild-gcc-12-x86-params
      defconfig:
        - x86_64_defconfig
        - allmodconfig
      kselftest: disable
    rules:
      tree:
      - 'android'

  kbuild-gcc-12-x86-android-allnoconfig:
    <<: *kbuild-gcc-12-x86-android-allmodconfig-job
    params:
      <<: *kbuild-gcc-12-x86-android-params
      defconfig:
        - x86_64_defconfig
        - allnoconfig

  # Default config and build only job
  kbuild-gcc-12-x86-build-only:
    <<: *kbuild-gcc-12-x86-job
    rules: *build-only-trees-rules

  kbuild-gcc-12-x86-kcidebug:
    <<: *kbuild-gcc-12-i386-job
    params:
      <<: *kbuild-gcc-12-i386-params
      defconfig: defconfig
      fragments:
        - kcidebug
        - x86-board
    rules:
      tree:
      - '!android'
      - '!chromiumos'

  kbuild-gcc-12-x86-kselftest:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      fragments:
        - 'kselftest'
        - 'x86-board'
    rules:
      <<: *kbuild-kselftest-rules

  kbuild-gcc-12-x86-mainline: &kbuild-gcc-12-x86-mainline-job
    <<: *kbuild-gcc-12-x86-job
    params: &kbuild-gcc-12-x86-mainline-params
      <<: *kbuild-gcc-12-x86-params
      fragments:
        - 'debug'
        - 'kselftest'
        - 'tinyconfig'
        - 'x86-board'
    rules:
      tree:
        - 'mainline'

  kbuild-gcc-12-x86-mainline-allnoconfig:
    <<: *kbuild-gcc-12-x86-mainline-job
    params:
      <<: *kbuild-gcc-12-x86-mainline-params
      defconfig:
        - x86_64_defconfig
        - allnoconfig

  kbuild-gcc-12-x86-next: &kbuild-gcc-12-x86-next-job
    <<: *kbuild-gcc-12-x86-job
    params: &kbuild-gcc-12-x86-next-params
      <<: *kbuild-gcc-12-x86-params
      fragments:
        - 'kselftest'
        - 'x86-board'
    rules:
      tree:
        - 'next'
        - 'sashal-next'

  kbuild-gcc-12-x86-next-allnoconfig:
    <<: *kbuild-gcc-12-x86-next-job
    params:
      <<: *kbuild-gcc-12-x86-next-params
      defconfig:
        - x86_64_defconfig
        - allnoconfig
      fragments:
        - 'x86-board'

  kbuild-gcc-12-x86-mediatek:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      fragments:
       - 'x86-board'
    rules:
      tree:
      - 'mediatek'

  kbuild-gcc-12-x86-mfd:
    <<: *kbuild-gcc-12-x86-job
    rules:
      tree:
      - 'lee-mfd'

  kbuild-gcc-12-x86-preempt_rt:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      fragments:
       - 'preempt_rt'
      defconfig: defconfig
    rules:
      tree:
      - 'stable-rt'
      - 'mainline'
      - 'next'

  kbuild-gcc-12-x86-preempt_rt_x86_board:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      fragments:
       - 'preempt_rt'
       - 'x86-board'
      defconfig: defconfig
    rules:
      tree:
      - 'stable-rt'
      - 'mainline'
      - 'next'

  kbuild-gcc-12-x86-tinyconfig:
    <<: *kbuild-gcc-12-x86-job
    params:
      <<: *kbuild-gcc-12-x86-params
      defconfig: tinyconfig
    rules:
      tree:
      - 'kernelci'
      - 'stable-rc'
      - 'stable'

  blktests-ddp-x86:
    template: blktests-ddp.jinja2
    kind: job
    params:
      test_method: blktests-ddp
      job_timeout: 30
      rootfs: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-blktest/20250212.0/amd64'
    rules:
      tree:
        - aaptel
        - netdev-testing
    kcidb_test_suite: blktests-ddp

  # Named so it sorts before all the actual kselftests, we need to
  # specify a kselftest suite for YAML validation.
  kselftest-aaa: &kselftest-job
    template: generic.jinja2
    kind: job
    params: &kselftest-params
      test_method: kselftest
      boot_commands: nfs
      nfsroot: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-kselftest/20250117.0/{debarch}'
      job_timeout: 10
    rules: &kselftest-rules
      tree:
        - mainline
        - next
        - stable-rc
        - stable
    kcidb_test_suite: kselftest.aaa

  kselftest-alsa:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: alsa
    kcidb_test_suite: kselftest.alsa

  kselftest-arm64:
    <<: *kselftest-job
    template: generic.jinja2
    kind: job
    params:
      <<: *kselftest-params
      collections: arm64
    kcidb_test_suite: kselftest.arm64

  kselftest-capabilities:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: capabilities
    kcidb_test_suite: kselftest.capabilities

  kselftest-clone3:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: clone3
    kcidb_test_suite: kselftest.clone3

  kselftest-cpufreq:
    <<: *kselftest-job
    template: generic.jinja2
    kind: job
    params:
      <<: *kselftest-params
      collections: cpufreq
    kcidb_test_suite: kselftest.cpufreq

  kselftest-cpufreq-hibernate:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: cpufreq
      env: 'KSELFTEST_MAIN_SH_ARGS="-t hibernate_rtc"'
    rules:
      <<: *kselftest-rules
      min_version:
        version: 6
        patchlevel: 12
    kcidb_test_suite: kselftest.cpufreq.hibernate

  kselftest-cpufreq-suspend:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: cpufreq
      env: 'KSELFTEST_MAIN_SH_ARGS="-t suspend_rtc"'
    rules:
      <<: *kselftest-rules
      min_version:
        version: 6
        patchlevel: 12
    kcidb_test_suite: kselftest.cpufreq.suspend

  kselftest-devices-exist:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      test_method: kselftest-platform-parameters
      collections: devices/exist
      env: "KSELFTEST_TEST_DEV_EXIST_PY_ARGS=--reference-dir=/opt/platform-test-parameters-main/kselftest/devices/exist/"
    rules:
      tree:
        - collabora-next:for-kernelci
    kcidb_test_suite: kselftest.devices-exist

  kselftest-device-error-logs-main:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: devices/error_logs
    kcidb_test_suite: kselftest.device_error_logs

  kselftest-devices-probe:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: devices/probe
      env: "KSELFTEST_TEST_DISCOVERABLE_DEVICES_PY_ARGS=--boards-dir=/opt/platform-test-parameters/kselftest/test_discoverable_devices/boards/"
    rules:
      <<: *kselftest-rules
      min_version:
        version: 6
        patchlevel: 11
    kcidb_test_suite: kselftest.devices-probe

  kselftest-dmabuf-heaps:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: dmabuf-heaps
    kcidb_test_suite: kselftest.dmabuf-heaps

  kselftest-dt:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: dt
    rules:
      <<: *kselftest-rules
      min_version:
        version: 6
        patchlevel: 7
    kcidb_test_suite: kselftest.dt

  kselftest-exec:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: exec
    kcidb_test_suite: kselftest.exec

  kselftest-ftrace:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: ftrace
    kcidb_test_suite: kselftest.ftrace

  kselftest-futex:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: futex
    kcidb_test_suite: kselftest.futex

  kselftest-iommu:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: iommu
    kcidb_test_suite: kselftest.iommu

  kselftest-ipc:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: ipc
    kcidb_test_suite: kselftest.ipc

  kselftest-kvm:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: kvm
    kcidb_test_suite: kselftest.kvm

  kselftest-landlock:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: landlock
    kcidb_test_suite: kselftest.landlock

  # No hugepages allocation (for architectures without it)
  kselftest-mm:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      extra_kernel_args: "secretmem.enable kpti=off"
      collections: mm
    kcidb_test_suite: kselftest.mm

  # hugepages allocation suitable for machines with 2G of memory
  kselftest-mm-2g:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      extra_kernel_args: "secretmem.enable hugepagesz=32M hugepages=0:4 default_hugepagesz=2M hugepages=0:128 hugepagesz=64K hugepages=0:4 kpti=off"
      collections: mm
    kcidb_test_suite: kselftest.mm

  kselftest-mqueue:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: mqueue
    kcidb_test_suite: kselftest.mqueue

  kselftest-net:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: net
      job_timeout: 300
      skipfile: https://storage.kernelci.org/skipfile-net.yaml
    kcidb_test_suite: kselftest.net

  kselftest-perf-events:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: perf_events
    kcidb_test_suite: kselftest.perf_events

  kselftest-seccomp:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: seccomp
    kcidb_test_suite: kselftest.seccomp

  kselftest-signal:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: signal
    kcidb_test_suite: kselftest.signal

  kselftest-timers:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: timers
    kcidb_test_suite: kselftest.timers

  kselftest-ublk:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: ublk
    kcidb_test_suite: kselftest.ublk

  kselftest-uevent:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: uevent
    kcidb_test_suite: kselftest.uevent

  kselftest-user-events:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: user_events
    kcidb_test_suite: kselftest.user_events

  kselftest-vdso:
    <<: *kselftest-job
    params:
      <<: *kselftest-params
      collections: vDSO
    kcidb_test_suite: kselftest.vdso

  kunit: &kunit-job
    template: kunit.jinja2
    kind: job
    image: ghcr.io/kernelci/{image_prefix}gcc-12:x86-kunit-kernelci
    kcidb_test_suite: kunit
    rules:
      tree:
      - '!chromiumos'

  kunit-x86_64:
    <<: *kunit-job
    params:
      arch: x86_64

  ltp-cap-bounds:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "cap_bounds"

  ltp-containers:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "containers"

  ltp-controllers:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "controllers"

  ltp-cpuhotplug:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "cpuhotplug"

  ltp-crypto:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "crypto"
    rules:
      fragments:
        - 'crypto'
        - '!kselftest'

  ltp-cve:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "cve"
      job_timeout: 45

  ltp-dio:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "dio"

  ltp-fcntl-locktests:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fcntl-locktests"

  ltp-filecaps:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "filecaps"

  ltp-fs:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fs"

  ltp-fs-bind:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fs_bind"

  ltp-fs-perms-simple:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fs_perms_simple"

  ltp-fs-readonly:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fs_readonly"

  ltp-fsx:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "fsx"

  ltp-hugetlb:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "hugetlb"

  ltp-ima:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "ima"
    rules:
      fragments:
        - 'ima'
        - '!kselftest'

  ltp-input:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "input"

  ltp-io:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "io"

  ltp-ipc:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "ipc"

  ltp-mm:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "mm"
      job_timeout: 30

  ltp-pty:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "pty"
      job_timeout: 25

  ltp-sched:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "sched"

  ltp-smoketest:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "smoketest"

  ltp-syscalls:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "syscalls"
      job_timeout: 120

  ltp-syscalls-ipc:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "syscalls"

  ltp-timers:
    <<: *ltp-job
    params:
      <<: *ltp-params
      grp_test: "TMR"
      job_timeout: 30

  ltp-timers_qemu:
    <<: *ltp-job
    base_name: ltp-timers
    params:
      <<: *ltp-params
      grp_test: "TMR"
      job_timeout: 30
    rules:
      defconfig:
        - 'defconfig'
      fragments:
        - '!kselftest'

  ltp-watchqueue:
    <<: *ltp-job
    params:
      <<: *ltp-params
      tst_cmdfiles: "watchqueue"

  rt-tests: &rt-tests
    template: rt-tests.jinja2
    kind: job
    params: &rt-tests-params
      boot_commands: nfs
      nfsroot: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-rt/20240806.0/{debarch}'
    kcidb_test_suite: rt-tests
    rules:
      fragments:
        - preempt_rt

  rt-tests-cyclicdeadline:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'cyclicdeadline'
    kcidb_test_suite: rt-tests.cyclicdeadline

  rt-tests-cyclictest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'cyclictest'
    kcidb_test_suite: rt-tests.cyclictest

  rt-tests-pi-stress:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'pi-stress'
    kcidb_test_suite: rt-tests.pi-params

  rt-tests-pmqtest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'pmqtest'
    kcidb_test_suite: rt-tests.pmqtest

  rt-tests-ptsematest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'ptsematest'
    kcidb_test_suite: rt-tests.ptsematest

  rt-tests-rt-migrate-test:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'rt-migrate-test'
    kcidb_test_suite: rt-tests.rt-migrate-test

  rt-tests-rtla-osnoise:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'rtla-osnoise'
      tst_group: 'rtla'
    kcidb_test_suite: rt-tests.rtla-osnoise

  rt-tests-rtla-timerlat:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'rtla-timerlat'
      tst_group: 'rtla'
    kcidb_test_suite: rt-tests.rtla-timerlat

  rt-tests-signaltest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'signaltest'
    kcidb_test_suite: rt-tests.signaltest

  rt-tests-sigwaittest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'sigwaittest'
    kcidb_test_suite: rt-tests.sigwaittest

  rt-tests-svsematest:
    <<: *rt-tests
    params:
      <<: *rt-tests-params
      tst_cmd: 'svsematest'
    kcidb_test_suite: rt-tests.svsematest

  # amd64-only temporary
  sleep:
    template: generic.jinja2
    kind: job
    params:
      test_method: sleep
      boot_commands: nfs
      nfsroot: http://storage.kernelci.org/images/rootfs/debian/bullseye/20240129.0/{debarch}
      sleep_params: mem freeze
    kcidb_test_suite: kernelci_sleep

  h26forge-debian:
    template: generic.jinja2
    kind: job
    params:
      test_method: h26forge-debian
      boot_commands: nfs
      nfsroot: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-gst-h26forge/20250117.0/{debarch}/'
    rules:
      tree:
        - media
    kcidb_test_suite: h26forge.debian

  wifi-basic:
    template: generic.jinja2
    kind: job
    params:
      test_method: wifi-basic
      boot_commands: nfs
      nfsroot: 'https://storage.kernelci.org/images/rootfs/debian/bookworm-wifi/20240313.0/{debarch}/'
    rules:
      tree:
        - mainline
        - stable-rc
    kcidb_test_suite: kernelci_wifi_basic
  
  nipa-update:
    template: nipa-update.jinja2
    kind: test
    image: kernelci/{image_prefix}kernelci
    kcidb_test_suite: kernelci_nipa-update
    rules:
      tree:
        - netdev-testing
